#!/bin/bash

collect_dir_list_configfiles()
# List all config files that needed for host
# stdin: -
# stdout: config file list array
# parameters: host management_config_folder suffix
# return: -
{
 if [ -z "$3" ]
 then
  echo "ERROR"
  echo "usage: $0 host management_config_folder suffix."
  exit 1
 fi

 local LOCAL_HOST
 local LOCAL_CONFIG_FOLDER_MANAGEMENT
 local LOCAL_SUFFIX
 local LOCAL_SOURCES

 LOCAL_HOST="$1"
 LOCAL_FOLDER_CONFIG_MANAGEMENT="$2"
 LOCAL_SUFFIX="$3"

 if [ ! -d "$LOCAL_FOLDER_CONFIG_MANAGEMENT/common-classes" ]
 then
  echo "ERROR"
  echo "$LOCAL_FOLDER_CONFIG_COMMON folder does not exists"
  exit 1
 fi

 LOCAL_SOURCES="$LOCAL_FOLDER_CONFIG_MANAGEMENT/common-classes/*.$LOCAL_SUFFIX"

 if [ -f "$LOCAL_FOLDER_CONFIG_MANAGEMENT/conditions/$LOCAL_HOST.condition" ]
 then
  LOCAL_SOURCES+=" "`sed -e "s|.*|$LOCAL_FOLDER_CONFIG_MANAGEMENT/conditions-classes/&.$LOCAL_SUFFIX|" "$LOCAL_FOLDER_CONFIG_MANAGEMENT/conditions/$LOCAL_HOST.condition"`
 fi

 if [ -f "$LOCAL_FOLDER_CONFIG_MANAGEMENT/nodes/$LOCAL_HOST.$LOCAL_SUFFIX" ]
 then
  LOCAL_SOURCES+=" $LOCAL_FOLDER_CONFIG_MANAGEMENT/nodes/$LOCAL_HOST.$LOCAL_SUFFIX"
 fi

 echo "$LOCAL_SOURCES"
}

collect_configfiles_list_entries()
# List all entries from config files
# stdin: -
# stdout: entries list array
# parameters: config_files entry_string
# return: -
{
 if [ -z "$2" ]
 then
  echo "ERROR"
  echo "usage: $0 config_files entry_string."
  exit 1
 fi

 local LOCAL_CONFIG_FILES
 local LOCAL_ENTRY_STRING
 local LOCAL_ENTRIES

 LOCAL_CONFIG_FILES="$1"
 LOCAL_ENTRY_STRING="$2"

 LOCAL_ENTRIES=`grep -s -h "^$LOCAL_ENTRY_STRING  [^[:blank:]].*$" $LOCAL_CONFIG_FILES | cut -f 3 -d ' ' | sort`

 echo "$LOCAL_ENTRIES"
}

collect_list_list_sameentries()
# List same entries from two list
# stdin: -
# stdout: same entries list array
# parameters: array1 array2
# return: -
{
 if [ -z "$2" ]
 then
  echo "ERROR"
  echo "usage: $0 array array."
  exit 1
 fi

 local LOCAL_ARRAY1
 local LOCAL_ARRAY2
 local LOCAL_SAME_ENTRIES

 LOCAL_ARRAY1="$1"
 LOCAL_ARRAY2="$2"

 IFS=""
 LOCAL_SAME_ENTRIES=`comm -12 <(echo "${LOCAL_ARRAY1[*]}") <(echo "${LOCAL_ARRAY2[*]}" | cut -f 2 -d ' ' | sort)`

 echo "$LOCAL_SAME_ENTRIES"
}

collect_configfiles_list_fullentries()
# List same entries from two list
# stdin: -
# stdout: entries list array
# parameters: config_files prefix_sting1 prefix_string2 entry_list
# return: -
{
 if [ -z "$3" ]
 then
  echo "ERROR"
  echo "usage: $0 config_files prefix_string entries."
  exit 1
 fi

 local LOCAL_CONFIG_FILES
 local LOCAL_STRING_PREFIX
 local LOCAL_LIST_ENTRIES
 local LOCAL_GREP
 local LOCAL_ENTRIES

 LOCAL_CONFIG_FILES="$1"
 LOCAL_STRING_PREFIX1="$2"
 LOCAL_LIST_ENTRIES="$3"

 LOCAL_GREP=`printf "$LOCAL_LIST_ENTRIES" | tr "\n" "|"`

 grep -s -E "^$LOCAL_STRING_PREFIX  ($LOCAL_GREP)$" $LOCAL_CONFIG_FILES
}
